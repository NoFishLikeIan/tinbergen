---
title: "Homework 1, ARFIMA estimation"
output: html_notebook
---

## Libraries
```{r}
library(ggplot2)
library(xts)
library(tseries)
library(dplyr)
```


## Data input
```{r}
filepath <- file.path(getwd(), "data", "vix_data.csv")

df <- read.zoo(filepath, sep = ",", format = "%Y%m%d")

X <- log(as.xts(df))

dX <- na.trim(diff(X))

head(dX)
```

## Exercise 1 - Plot
We now can plot $X_t$ and the first difference $\Delta X_t$

```{r}
autoplot(X)
autoplot(dX)
```


Autcorellation function
```{r}

autocorr <- function(vector, h) {
  n <- length(vector)
  vec_dem <- vector-mean(vector)
  
  prev <- vec_dem[1:(n-abs(h))]
  subs <- vec_dem[(1+abs(h)):n]
  
  # X[1:h].T @ X[h:n] / X.T @ X
  rho_hat <- t(prev)%*%subs / t(vec_dem)%*%vec_dem
  
  
  return(rho_hat) 
} 

sample_acf <- function(series, hs) {
  vec <- as.vector(series)
  
  compute_autocorr <- function(h) autocorr(vec, h) 
  
  ac <- sapply(hs, compute_autocorr)
  
  return(ac)
}
```


The sample autocorrelation

```{r}
acf(X)
acf(dX)
```


It seems that the series $X_t$ is non stationary and hence we should start from $\Delta X_t$

## Excerice 2
```{r}
adf.test(as.ts(X))
adf.test(as.ts(dX))
```


## Exercise 3


```{r}
spectral_dens <- function(X, l) {
  n <- length(X)
  hs <- as.vector((1-n):(n-1))
  

  corrs <- sample_acf(X, hs)
  weights <- sapply(hs, function (h) if (abs(h) < l) 1 - abs(h)/(l+1) else 0)
  
  dens <- function(lambda) {
    cosines <- cos(lambda*hs)
    f_hat <- sum(weights*corrs*cosines)
    return (f_hat / (2*pi))
  }
  
  return (dens)
}
```


```{r}
l <- 33
dens <- spectral_dens(dX, l)
density_space <- seq(1, 2*pi, length.out=100)
estimated_dens <- sapply(density_space, dens)

df <- data.frame(lambda=density_space, f=estimated_dens)
ggplot(data=df, aes(lambda, f)) + geom_line()
```

```{r}
I_n <- estimated_dens
estimated_dens
```













